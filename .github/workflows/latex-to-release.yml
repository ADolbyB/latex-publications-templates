name: LaTeX â†’ PDF Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

permissions:
  contents: write          # Required for releases and assets

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # LaTeX compilation
      # Compile Publication 1 [article]
      - name: Compile A General Handheld Radio Primer article
        uses: xu-cheng/latex-action@v3
        with:
          root_file: 2025_HT1000_ch_guide.tex
          working_directory: Publications/Articles/Radio-HT1000
    
      # Compile Publication 2 [conference]
      - name: Compile Partial IEEE Backup template
        uses: xu-cheng/latex-action@v3
        with:
          root_file: IEEE-BackupTemplate.tex
          working_directory: Publications/Conference/Backup
            
      # Compile Publication 3 [conference]
      - name: Compile Disaster Management Paper
        uses: xu-cheng/latex-action@v3
        with:
          root_file: CrisisToControl.tex
          working_directory: Publications/Conference/DisasterMgmt

      # Compile Tutorial 00a
      - name: Compile Tutorial 00a
        uses: xu-cheng/latex-action@v3
        with:
          root_file: tutorial1.tex
          working_directory: Tutorials/00a-Tutorial1

      - name: Compile Tutorial 00b
        uses: xu-cheng/latex-action@v3
        with:
          root_file: MLABib.tex
          working_directory: Tutorials/00b-MLACites

      - name: Compile Tutorial 00c
        uses: xu-cheng/latex-action@v3
        with:
          root_file: BibTexChapters.tex
          working_directory: Tutorials/00c-UsingBibTex

      - name: Compile Tutorial 01
        uses: xu-cheng/latex-action@v3
        with:
          root_file: fcc-01-BasicStructure.tex
          working_directory: Tutorials/01-FCC-BasicStructure

      - name: Compile Tutorial 02
        uses: xu-cheng/latex-action@v3
        with:
          root_file: fcc-02-BasicMath.tex
          working_directory: Tutorials/02-FCC-BasicMath

      - name: Compile Tutorial 03
        uses: xu-cheng/latex-action@v3
        with:
          root_file: fcc-03.tex
          working_directory: Tutorials/03-FCC-TablesArrays

      - name: Compile Tutorial 04
        uses: xu-cheng/latex-action@v3
        with:
          root_file: fcc-04.tex
          working_directory: Tutorials/04-FCC-Lists

      - name: Compile Tutorial 05
        uses: xu-cheng/latex-action@v3
        with:
          root_file: fcc-05.tex
          working_directory: Tutorials/05-FCC-Formatting

      - name: Compile Tutorial 06
        uses: xu-cheng/latex-action@v3
        with:
          root_file: fcc-06.tex
          working_directory: Tutorials/06-FCC-MacrosGraphics

      - name: Compile Tutorial 07
        uses: xu-cheng/latex-action@v3
        with:
          root_file: fcc-07.tex
          working_directory: Tutorials/07-FCC-Debugging

      - name: Compile Tutorial 08
        uses: xu-cheng/latex-action@v3
        with:
          root_file: fcc-08.tex
          working_directory: Tutorials/08-FCC-Calculus

      - name: Compile Tutorial 09
        uses: xu-cheng/latex-action@v3
        with:
          root_file: fcc-09.tex
          working_directory: Tutorials/09-FCC-MathPaper

      - name: Compile Tutorial 10
        uses: xu-cheng/latex-action@v3
        with:
          root_file: beamer-tut.tex
          working_directory: Tutorials/10-FCC-BeamerPPT

      - name: Compile Tutorial 11a
        uses: xu-cheng/latex-action@v3
        with:
          root_file: conference_101719.tex
          working_directory: Tutorials/11a-IEEE-Conference

      - name: Compile Tutorial 11b
        uses: xu-cheng/latex-action@v3
        with:
          root_file: IEEE-JB.tex
          working_directory: Tutorials/11b-IEEE-withBib

      - name: Compile Tutorial 13
        uses: xu-cheng/latex-action@v3
        with:
          root_file: imageFlip.tex
          working_directory: Tutorials/13-imageFlipping

      # Add any others for compilation

      # Create ZIP of Compiled PDFs
      - name: Create Tutorials ZIP archive
        run: |
          zip -j TutorialsAllPDFs.zip \ 
            Tutorials/00a-Tutorial1/tutorial1.pdf \
            Tutorials/00b-MLACites/MLABib.pdf \
            Tutorials/00c-UsingBibTex/BibTexChapters.pdf \
            Tutorials/01-FCC-BasicStructure/fcc-01-BasicStructure.pdf \
            Tutorials/02-FCC-BasicMath/fcc-02-BasicMath.pdf \
            Tutorials/03-FCC-TablesArrays/fcc-03.pdf \
            Tutorials/04-FCC-Lists/fcc-04.pdf \
            Tutorials/05-FCC-Formatting/fcc-05.pdf \
            Tutorials/06-FCC-MacrosGraphics/fcc-06.pdf \
            Tutorials/07-FCC-Debugging/fcc-07.pdf \
            Tutorials/08-FCC-Calculus/fcc-08.pdf \
            Tutorials/09-FCC-MathPaper/fcc-09.pdf \
            Tutorials/10-FCC-BeamerPPT/beamer-tut.pdf \
            Tutorials/11a-IEEE-Conference/conference_101719.pdf \
            Tutorials/11b-IEEE-withBib/IEEE-JB.pdf \
            Tutorials/13-imageFlipping/imageFlip.pdf \
            2>/dev/null || true   # ignore missing files during test

      # Create/Update release and upload assets
      - name: Create Release & Upload Assets
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ github.ref_name }}     # defaults to the pushed tag
          name: Release ${{ github.ref_name }}
          draft: false
          prerelease: false
          generate_release_notes: true
          body: |
            Auto-generated release with compiled PDFs and tutorials archive.
            
            - 3 main publication PDFs
            - All tutorial PDFs in one ZIP
          files: |
            Publications/Articles/Radio-HT1000/2025_HT1000_ch_guide.pdf
            Publications/Conference/Backup/IEEE-BackupTemplate.pdf
            Publications/Conference/DisasterMgmt/CrisisToControl.pdf
            TutorialsAllPDFs.zip
          overwrite_files: true               # useful for testing/re-runs
          fail_on_unmatched_files: true       # fail fast if a PDF is missing